const bandeja = {
    template: `{{> bandeja/bandejaHTML.hbs}}`,
    data() {
        return {
            mensajes: [],
            selected: null,
            loading: true
        }
    },
    methods: {
        convertDate: convertDate,
        seleccionarMensaje() {
            var id = this.$route.params.id;
            this.selected = id;
        },
        marcarVistoAPI() {
            if(this.getMessageSelected == null) {
                return;
            }
            
            var request = {
                url: "http://{{ ip }}/api/bandeja/visto",
                type: "POST",
                context: this,
                cache: false,
                success(data) {
                    if(data.code == 200) {
                        console.log(data);
                    }
                    else if(data.code == 403) {
                        app.showSessionEndedAlert(true);
                    }
                    else {
                        app.createCommonErrors(data);
                    }
                },
                error(data) {
                    app.createCommonErrors(data);
                },
                complete() {

                }
            };
            $.ajax(request);
        },
        cargarMensajesAPI() {
            this.loading = true;
            var request = {
                url: "http://{{ ip }}/api/bandeja",
                type: "GET",
                context: this,
                success(data) {
                    if(data.code == 200) {
                        if(data.mensajes != undefined)
                            this.mensajes = data.mensajes;
                    }
                    else if(data.code == 403) {
                        app.showSessionEndedAlert(true);
                    }
                    else {
                        app.createCommonErrors(data);
                    }
                },
                error(data) {
                    app.createCommonErrors(data);
                },
                complete(data) {
                    this.loading = false;
                }
            };
            $.ajax(request);
        },
        getMessageSelected() {
            var mensajeSeleccionado = null;
            for(var i = 0; i < this.mensajes.length; i++) {
                if(this.mensajes[i].id == this.selected) {
                    mensajeSeleccionado = this.mensajes[i];
                }
            }
            return mensajeSeleccionado;
        }
    },
    watch: {
        $route(to, from) {
            this.seleccionarMensaje()
        }
    },
    mounted() {
        this.cargarMensajesAPI();
        this.seleccionarMensaje();
    }
};