const asociarIngreso = {
    template: `{{> asociarIngreso/asociarIngresoHTML.hbs}}`,
    props: {
        confirmarAccion: Function,
        cancelarAccion: Function
    },
    data() {
        return {
            ingresosSelect: [],
            ingresoSelected: null,
            ingresosLoading: false
        }
    },
    methods: {
        cargarIngresosAPI(){            
            this.ingresosLoading = true;
            $.ajax({
                url: "http://{{ ip }}/api/operaciones/ingresos",
                type: "GET",
                dataType: "json",
                context: this,
                success(response) {
                    if(response.code == 403) {
                        app.showSessionEndedAlert(true);
                    } else if(response.code == 200) {
                        console.log(response);
                        this.ingresosSelect = response.ingresos.map(this.ingresosAPIConverter);
                    }
                },
                error(response) {
                    console.log("error");
                    console.log(response);
                },
                complete() {
                    this.ingresosLoading = false;
                }
            });
        },
        ingresosAPIConverter(ingresoAPI) {
            return {
                value: {
                    id: ingresoAPI.id, 
                    montoTotal: ingresoAPI.montoTotal, 
                    descripcion: ingresoAPI.descripcion
                },
                text: ingresoAPI.descripcion + ' - $' + ingresoAPI.montoTotal
            }
        }
    },
    mounted() {
        this.cargarIngresosAPI();
    }
}