<!-- template para nuevo egreso -->
<div class="pt-3">
    <div class="row mb-4 mx-2">
        <div class="col py-2 text-center">
            <h2>Cargar nuevo egreso</h2>
        </div>
    </div>
    <div class="row mb-4 mx-2">
        <div class="col-sm-4 col-lg-3 text-sm-right py-2">
            <span class="mr-2"><strong>Organización</strong></span>
        </div>
        <div class="col bg-light p-2">
            <span class="ml-2">NombreOrganización</span>
        </div>
        <div class="col-lg-1 col-xl-3"></div>
    </div>
    <div class="row mb-4 mx-2">
        <div class="col-sm-4 col-lg-3 text-sm-right py-2">
            <span class="mr-2"><strong>Fecha Operación</strong></span>
        </div>
        <div class="col">
            <b-collapse :visible="(!egreso.fechaOperacion && falloInput)">
                <b-badge variant="danger">Ingrese la fecha de la operacion</b-badge>
            </b-collapse>
            <b-form-datepicker placeholder="Seleccione fecha de la Operación" class="mb-2"
                :state="(!egreso.fechaOperacion && falloInput) ? false : null"
                v-model="egreso.fechaOperacion"
            ></b-form-datepicker>
        </div>
        <div class="col-lg-1 col-xl-3"></div>
    </div>
    <div class="row mb-4 mx-2 justify-content-between">
        <div class="col-sm-4 col-lg-3 text-sm-right py-2">
            <span class="mr-2"><strong>Proveedor</strong></span>
        </div>
        <div class="col d-flex align-items-end">
            <div class="w-100">
                <b-collapse :visible="(!egreso.proveedor && falloInput)">
                    <b-badge variant="danger">Seleccione un proveedor</b-badge>
                </b-collapse>
                <b-overlay spinner-variant="primary" :show="proveedoresLoading" rounded="sm">
                    <b-form-select
                        :options="proveedoresSelect" 
                        :state="(!egreso.proveedor && falloInput) ? false : null"
                        v-model="egreso.proveedor">
                        <template #first>
                            <b-form-select-option :value="null" disabled>-- Selecciona un Proveedor --</b-form-select-option>
                        </template>
                        <template>
                            <b-form-select-option class="text-primary" v-if="(proveedorAAgregar != null)" value="nuevoProveedor">\{{ proveedorAAgregar.nombre }} (nuevo)</b-form-select-option>
                        </template>
                    </b-form-select>
                </b-overlay>
            </div>
        </div>
        <div class="col d-flex align-items-end">
            <b-button block variant="outline-primary" v-b-modal.modal-agregar-proveedor>
                <b-icon-plus></b-icon-plus>
                Cargar Proveedor
            </b-button>
        </div>
        <div class="col-lg-1 col-xl-3"></div>
    </div>
    <div class="row mb-4 mx-2 justify-content-between">
        <div class="col-sm-4 col-lg-3 text-sm-right py-2">
            <span class="mr-2"><strong>Medio de Pago</strong></span>
        </div>
        <div class="col d-flex align-items-end">
            <div class="w-100">
                <b-collapse :visible="(!egreso.medioDePago.id && falloInput)">
                    <b-badge variant="danger">Seleccione un medio de pago</b-badge>
                </b-collapse>
                <b-overlay spinner-variant="primary" :show="mediosDePagoLoading" rounded="sm">
                    <b-form-select 
                        :options="mediosDePagoSelect"
                        :state="(!egreso.medioDePago.id && falloInput) ? false : null"
                        v-model="egreso.medioDePago.id">
                        <template #first>
                            <b-form-select-option :value="null" disabled>-- Seleccionar un Medio de Pago --</b-form-select-option>
                        </template>
                    </b-form-select>
                </b-overlay>
            </div>
        </div>
        <div class="col d-flex align-items-end">
            <div class="w-100">
                <b-collapse :visible="(!egreso.medioDePago.dato && falloInput)">
                    <b-badge variant="danger">Ingrese el número de pago</b-badge>
                </b-collapse>
                <b-form-input placeholder="Ingrese número de pago" 
                    :state="(!egreso.medioDePago.dato && falloInput) ? false : null"
                    v-model="egreso.medioDePago.dato"
                ></b-form-input>
            </div>
        </div>
        <div class="col-lg-1 col-xl-3"></div>
    </div>
    <div class="row mb-4 mx-2">
        <div class="col-sm-4 col-lg-3 text-sm-right py-2">
            <span class="mr-2"><strong>Documento comercial</strong></span>
        </div>
        <div class="col">
            <div class="p-2 container-fluid border border rounded">
                <div class="row mb-2">
                    <div class="col-sm-4 text-sm-right py-2">
                        <span class="mr-2"><strong>Tipo</strong></span>
                    </div>
                    <div class="col">
                        <b-collapse :visible="(!egreso.documentoComercial.tipo && falloInput)">
                            <b-badge variant="danger">Seleccione un tipo de documento</b-badge>
                        </b-collapse>
                        <b-form-select 
                            :options="tipoDocumentoSelect"
                            :state="(!egreso.documentoComercial.tipo && falloInput) ? false : null"
                            v-model="egreso.documentoComercial.tipo">
                            <template #first>
                                <b-form-select-option :value="null" disabled>-- Seleccionar un Tipo de Documento --</b-form-select-option>
                            </template>
                        </b-form-select>
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-sm-4 text-sm-right py-2">
                        <span class="mr-2"><strong>Número documento</strong></span>
                    </div>
                    <div class="col">
                        <b-collapse :visible="(!egreso.documentoComercial.numeroDocumento && falloInput)">
                            <b-badge variant="danger">Ingrese el número de documento</b-badge>
                        </b-collapse>
                        <b-form-input placeholder="Ingrese número de documento" 
                            :state="(!egreso.documentoComercial.numeroDocumento && falloInput) ? false : null"
                            v-model="egreso.documentoComercial.numeroDocumento"
                        ></b-form-input>
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-sm-4 text-sm-right py-2">
                        <span class="mr-2"><strong>Fecha de Pedido</strong></span>
                    </div>
                    <div class="col">
                        <b-collapse :visible="(!egreso.documentoComercial.fechaDePedido && falloInput)">
                            <b-badge variant="danger">Ingrese la fecha de pedido</b-badge>
                        </b-collapse>
                        <b-form-datepicker placeholder="Seleccione fecha de Pedido" class="mb-2"
                            :state="(!egreso.documentoComercial.fechaDePedido && falloInput) ? false : null"
                            v-model="egreso.documentoComercial.fechaDePedido"></b-form-datepicker>
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-sm-4 text-sm-right py-2">
                        <span class="mr-2"><strong>Fecha de Entrega</strong></span>
                    </div>
                    <div class="col">
                        <b-collapse :visible="(!egreso.documentoComercial.fechaDeEntrega && falloInput)">
                            <b-badge variant="danger">Ingrese la fecha de entrega</b-badge>
                        </b-collapse>
                        <b-form-datepicker placeholder="Seleccione fecha de Entrega" class="mb-2" 
                        :state="(!egreso.documentoComercial.fechaDeEntrega && falloInput) ? false : null"
                        v-model="egreso.documentoComercial.fechaDeEntrega"></b-form-datepicker>
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-sm-4 text-sm-right py-2">
                        <span class="mr-2"><strong>Descripción</strong></span>
                    </div>
                    <div class="col">
                        <b-col class="px-0 mx-0">
                            <b-form-textarea rows="3" max-rows="6"
                                placeholder="Breve descripción" v-model="egreso.documentoComercial.descripcion"
                            ></b-form-textarea>
                        </b-col>
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-sm-4 text-sm-right py-2">
                        <span class="mr-2"><strong>Imagen</strong></span>
                    </div>
                    <div class="col p-2">
                        <span class="ml-2">We'll see...</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-1 col-xl-3"></div>
    </div>
    <div class="row mb-4 mx-2">
        <div class="col-sm-4 col-lg-3 text-sm-right py-2">
            <span class="mr-2"><strong>Items</strong></span>
        </div>
        <div class="col">
            <b-collapse :visible="(!egreso.items.length && falloInput)">
                <b-badge variant="danger">Ingrese por lo menos un item</b-badge>
            </b-collapse>
            <tabla-items
                v-bind:actualizarItems="actualizarItems"
            ></tabla-items>
        </div>
        <div class="col-lg-1 col-xl-3"></div>
    </div>
    <div class="row mb-4 mx-2">
        <div class="col-sm-4 col-lg-3 text-sm-right py-2">
            <span class="mr-2"><strong>Presupuestos</strong></span>
        </div>
        <div class="col">
            <b-button variant="outline-primary" v-b-modal.modal-agregar-presupuesto>
                <b-icon-plus></b-icon-plus>
                Cargar Presupuestos
            </b-button>
            <div class="pt-2" v-if="presupuestosAAgregar.length">
                <p>Al egreso se le asociaran los siguientes presupuestos: </p>
                <b-table small class="mb-0 rounded" :fields="presupuestosAAgregarCampos" :items="presupuestosAAgregar">
                    <template #cell(fechaVigente)="data">
                        \{{ convertDate(data.item.fechaVigente) }}
                    </template>
                    <template #cell(items)="data">
                        \{{ data.item.items.length }}
                    </template>
                    <template #cell(delete)="data">
                        <b-button variant="outline" class="p-0 m-0 text-danger" @click="removerPresupuesto(data.index)">
                            <b-icon-x></b-icon-x>
                        </b-button>
                    </template>
                </b-table>
            </div>
        </div>
        <div class="col-lg-1 col-xl-3"></div>
    </div>
    <div class="row mb-4 mx-2">
        <div class="col-sm-4 col-lg-3 text-sm-right py-2">
            <span class="mr-2"><strong>Acciones</strong></span>
        </div>
        <div class="col">
            <b-button-group class="w-100">
                <b-button v-b-modal.modal-asociar-ingreso>Asociar a Ingreso</b-button>
                <b-button v-b-modal.modal-asociar-categoria>Asociar a Categorías</b-button>
            </b-button-group>
            <div class="pt-2" v-if="ingresoAAsociar">
                <b-collapse v-if="ingresoAAsociar" :visible="precioTotal() > ingresoAAsociar.montoTotal">
                    <b-badge variant="danger">El egreso supera el monto del ingreso</b-badge>
                </b-collapse>
                <span>El egreso se asociará al siguiente ingreso: </span>
                <b-badge>\{{ ingresoAAsociar.descripcion + ' - $' + ingresoAAsociar.montoTotal}}</b-badge>
            </div>
            <div class="pt-2" v-if="categoriasAAsociar.length">
                <span>El egreso se asociará a las siguientes categorías: </span>
                <template
                    v-for="(categoria, index) in categoriasAAsociar"
                >
                    <b-badge class="mr-1">\{{ categoria }}</b-badge>
                </template>
            </div>
        </div>
        <div class="col-lg-1 col-xl-3"></div>
    </div>
  
    <div class="row mb-4 mx-2">
        <div class="col-sm-4 col-lg-3 text-sm-right py-2">
            <span class="mr-2"><strong>Suscribirse</strong></span>
        </div>
        <div class="col px-2">
            <b-form-checkbox class="py-2 ml-2" v-model="suscribirse">Suscribirse a este egreso</b-form-checkbox>
        </div>
        <div class="col-lg-1 col-xl-3"></div>
    </div>

    <div class="row mb-4 mx-2">
        <div class="col-sm-4 col-lg-3 text-sm-right py-2">

        </div>
        <div class="col">
            <b-collapse :visible="(falloInput)">
                <b-badge variant="danger">Hay problemas en los campos</b-badge>
            </b-collapse>
            <b-collapse :visible="(falloCarga)">
                <b-badge variant="danger">Hubo un problema al cargar el egreso</b-badge>
            </b-collapse>
            
            <b-overlay spinner-variant="primary" :show="egresoLoading && !falloCarga" rounded="sm">
                <b-button-group>
                    <b-button variant="primary" @click="confirmar">Confirmar</b-button>
                    <b-button variant="outline-dark" to="/operaciones/egreso">Cancelar</b-button>
                </b-button-group>
            </b-overlay>
        </div>
        <div class="col-lg-1 col-xl-3"></div>
    </div>
    
    <b-modal id="modal-asociar-categoria" hide-footer scrollable centered title="Asociar a Categoría">
        <asociar-categoria
            v-bind:confirmarAccion="confirmarAsociarCategorias"
            v-bind:cancelarAccion="cancelarAsociarCategorias"
        ></asociar-categoria>
    </b-modal>
    
    <b-modal id="modal-asociar-ingreso" hide-footer scrollable centered title="Asociar a Ingreso">
        <asociar-ingreso
            v-bind:confirmarAccion="confirmarAsociarIngreso"
            v-bind:cancelarAccion="cancelarAsociarIngreso"
        ></asociar-ingreso>
    </b-modal>

    <b-modal id="modal-agregar-proveedor" size="xl" hide-footer scrollable centered title="Crear nuevo Proveedor">
        <agregar-proveedor 
            v-bind:confirmarAccion="confirmarNuevoProveedor"
            v-bind:cancelarAccion="cancelarNuevoProveedor"
        ></agregar-proveedor>
    </b-modal>

    <b-modal id="modal-agregar-presupuesto" size="xl" hide-footer scrollable centered title="Crear nuevo Presupuesto">
        <agregar-presupuesto
            v-bind:confirmarAccion="confirmarNuevoPresupuesto"
            v-bind:cancelarAccion="cancelarNuevoPresupuesto"
        ></agregar-presupuesto>
    </b-modal>
</div>