const egreso = {
    props: {
        egresoLoaded: Function
    },
    template: `{{> egreso/egresoHTML.hbs}}`,
    data() {
        return {
            egreso: null,
            campos_items: [
                {
                    key: 'producto',
                    label: 'Producto',
                    tdClass: ['w-100'],
                    thClass: []
                },
                {
                    key: 'cantidad',
                    label: 'Cantidad',
                    tdClass: ['text-center'],
                    thClass: ['text-center']
                },
                {
                    key: 'precio',
                    label: 'Precio',
                    tdClass: ['text-center'],
                    thClass: ['text-center']
                }
            ]
        }
    },
    methods: {
        cargarEgresoAPI() {
            var id = this.$route.params.id;
            if(id == undefined)
                return;

            console.log(id);

            $.ajax({
                url: "http://{{ ip }}/api/operaciones/egreso/"+id,
                type: "GET",
                dataType: "json",
                context: this,
                cache: false,
                success(response) {
                    if(response.code == 403) {
                        app.showSessionEndedAlert(true);
                    } else if(response.code == 200) {
                        console.log(response);
                        this.egreso = response.egreso;
                        this.egreso.items = response.egreso.items.map(this.itemEgresoAPIConverter);
                    }
                },
                error(response) {
                    console.log("error");
                    console.log(response);
                },
                complete() {
                    this.egresoLoaded();
                }
            });
        },
        itemEgresoAPIConverter(item) {
            return {
                producto: item.producto.nombreProducto,
                cantidad: item.cantidad,
                precio: item.precio
            }
        }
    },
    mounted() {
        this.cargarEgresoAPI();
    }
}